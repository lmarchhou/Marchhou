# Default values for solar.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

## common settings and setting for solar

## setting for front
front:
  replicaCount: 1
  image:
    repository: registry-dev.uihcloud.cn/com.uih.uplus/solar_front
    tag: latest
    pullPolicy: Always

  resources: 
    limits:
        cpu: "1000m"
        memory: "100Mi"
    requests:
        cpu: "1000m"
        memory: "100Mi"
  nodeSelector: {}

  service:
    type: NodePort
    nodePort: 30210

  ingress:
    enabled: false
    hosts:
    - host: solar-test.k8s-test.com
      paths: [/]


  confFile: |-
      server {
        listen       80;
        server_name  localhost;
        proxy_read_timeout 300s;
        add_header X-Frame-Options SAMEORIGIN;

        location / {
          root   /usr/share/nginx/html;
          index  index.html index.htm;
          try_files $uri /index.html;
        }

        location /bs {
          root   /usr/share/nginx/html;
          index  index.html index.htm;
          try_files $uri /bs/index.html;
        }

        location /file {
          root   /usr/share/nginx/html;
          add_header   Content-Type     "application/octet-stream;charset=utf-8";
          add_header   Content-Disposition "attachment; filename*=utf-8'zh_cn'$arg_n";
        }

        location /api/log/ {
          proxy_pass   http://10.6.209.46:30214/;
          proxy_cookie_path / "/; httponly; secure";
        }

        location /api/alerts/ {
          proxy_pass   http://10.6.209.46:30217/;
          proxy_cookie_path / "/; httponly; secure";
        }

        location /api/ {
          proxy_pass   http://10.6.209.46:30211/;
          proxy_cookie_path / "/; httponly; secure";
        }

        location /auth-server/ {
          proxy_pass   http://10.6.209.23:30420/v1/;
        }

        location /api/uap-portal/ {
          proxy_pass http://10.6.209.23:30421/portal-api/v1/;
        }

        location /uap-portal-web/ {
          rewrite   "/uap-portal-web/(.*)"   https://portal-sit-api.uihcloud.cn/$1;
        }

      }

## setting for solar log-migration
logmigration:
  replicaCount: 1
  image:
    repository: registry-dev.uihcloud.cn/com.uih.uplus/solar_logmigration
    tag: latest
    pullPolicy: Always

  resources: 
    limits:
        cpu: "1000m"
        memory: "512Mi"
    requests:
        cpu: "1000m"
        memory: "512Mi"
  nodeSelector: {}

  service:
    type: NodePort
    nodePort: 30218

  applicationConf: |-
    server:
      port: 2222

    # Swagger界面内容配置
    swagger:
      title: Solar-migrationlog API接口文档 #文档title
      description: Solar-migrationlog Api Documentation #接口描述
      version: 1.0.1 #版本


    elasticSearch:
      hosts: 10.6.209.48:9200

    config:
      receiver:
      device-ips: 10.8.12.2,10.3.11.241,10.3.11.150,10.3.34.125   #配置需同步设备的IP地址，多个地址间用','分隔，如果要同步全部设备则设置为'all'
      task-switch: 1 #设置同步SC数据定时任务开关，1是开，0是关
      scheduled:
        cron: 0 */1 * * * ? #定时拉取SC日志，每分钟一次
      #数据同步定时任务相关的配置
      sopToSolar:
        task-switch: 1 #设置定时任务开关，1是开，0是关
        scheduled:
          cron: 0 0 20 * * ? #定时同步数据，每天凌晨1点 0 0 1 * * ?

    spring:
      redis:
        database: 0
        host: 10.6.209.48
        port: 6379
        jedis:
          pool:
            max-active: 8
            max-wait: 1
            max-idle: 8
            min-idle: 0
        timeout: 1000
      migration:
        datasource:
          url: jdbc:sqlserver://10.6.119.21:1433;databasename=SC
          driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver
          username: sa
          password: ServiceCenter@123
          type: com.alibaba.druid.pool.DruidDataSource
      # 同步数据库配置
      equipment:
        datasource:
          username: solar
          password: 1qaz@WSX
          url: jdbc:mysql://10.6.209.48:3306/solar_equipment?useUnicode=true&characterEncoding=utf-8&useSSL=true&serverTimezone=UTC&allowMultiQueries=true
          driver-class-name: com.mysql.cj.jdbc.Driver
          type: com.alibaba.druid.pool.DruidDataSource
      # solar中间库配置
      sop:
        datasource:
          url: jdbc:mysql://10.6.209.223:3306/solar_middle?useUnicode=true&characterEncoding=UTF-8&serverTimezone=GMT%2B8&allowMultiQueries=true&useAffectedRows=true
          username: solar
          password: 1qaz@WSX
          driver-class-name: com.mysql.cj.jdbc.Driver
          type: com.alibaba.druid.pool.DruidDataSource
      application:
        name: microservice-provider
      data:
        mongodb:
          host: 10.6.119.22
          port: 27017
          database: servicecenter
          #username:
          #password:
      kafka:
        bootstrap-servers: 10.6.209.48:9092
        producer:
          acks: 1
          buffer-memory: 67108864
          compression-type: lz4
          retries: 10
          batch-size: 65536

    #健康检查
    management:
      endpoints:
        web:
          base-path: /
      endpoint:
        health:
          show-details: never

    # 集成日志配置
    logging:
      level:
        com:
          uih:
            uplus:
              log:
                svc: info #info、warn、error、off
                dev: info #debug、 info、warn、error、off
      service: solar-log-migration #微服务名称

    api:
      uapApiUrl: https://portal-sit-api.uihcloud.cn/portal-api/v1 # UAP PORTAL API，包含角色权限,URL最后不要加/


## setting for solar management
mgr:
  debug: false
  replicaCount: 1
  image:
    repository: registry-dev.uihcloud.cn/com.uih.uplus/solar_management
    tag: latest
    pullPolicy: Always

  resources: 
    limits:
        cpu: "1000m"
        memory: "512Mi"
    requests:
        cpu: "1000m"
        memory: "512Mi"
  nodeSelector: {}

  service:
    type: NodePort
    nodePort: 30211

  applicationConf: |-
    server:
      port: 1429
      session:
        cookie:
          http-only: true
          secure: true

    swagger:
      title: solar-equipment-management API接口文档 #文档title
      description: solar-equipment-management Api Documentation #接口描述
      version: 1.0.1 #版本

      # 数据源
    spring:
      redis:
        database: 0
        host: 10.6.209.48
        port: 6379
        jedis:
          pool:
            max-active: 8
            max-wait: 1
            max-idle: 8
            min-idle: 0
        timeout: 1000
      application:
        name: solar-equipment-management
      datasource:
        username: solar
        password: 1qaz@WSX
        url: jdbc:mysql://10.6.209.48:3306/solar_equipment?useUnicode=true&characterEncoding=utf-8&useSSL=true&serverTimezone=UTC&allowMultiQueries=true
        driver-class-name: com.mysql.cj.jdbc.Driver
        type: com.alibaba.druid.pool.DruidDataSource

    # grpc配置
    grpc:
     client:
      solar-equipment-alert:
       address: "static://solar-alert:2428"
       enableKeepAlive: true
       keepAliveWithoutCalls: true
       negotiationType: PLAINTEXT   # 此部分的意义为不进行TSL认证
     server:
      port: 2429

    # 集成日志配置
    logging:
      level:
        com:
          uih:
            uplus:
              log:
                svc: info #info、warn、error、off
                dev: info #debug、 info、warn、error、off
      service: solar-equipment-management #微服务名称

    # 多租户配置
    auth:
      anon: /swagger-ui.html,/swagger/**,/webjars/**,/swagger-resources/**,/v2/api-docs,/v1/file/**, /v1/code/**,/health*,/v1/devices/get-image-resource/**,/v1/carouselPics/**
      #,/v1/Permission/**    # 可匿名访问路由列表
      oidc:
        provider:
          baseUrl: https://auth-sit-api.uihcloud.cn/v1 # Demo环境统一登录服务地址,URL最后不要加/
    api:
      uapApiUrl: https://portal-sit-api.uihcloud.cn/portal-api/v1 # UAP PORTAL API，包含角色权限,URL最后不要加/
      serviceRoleCode: Service

    #id生成方式，false会调用DefaultIdentifierGenerator来生成id；true会初始化UidGenerator，调用grpc
    uidGenerator:
      open: false
    #云存储配置
    uploadConfig:
      storageType: "s3" #必填，存储类型 nas 或s3
      endPoint: "http://10.6.5.186:9000"   # 必填（为后续兼容s3），存储服务器地址，nas传“”即可
      accessKey: "minioadmin"  # 必填（为后续兼容s3），接入证书，nas传“”即可
      secretKey: "minioadmin"  # 必填（为后续兼容s3），安全证书，nas传“”即可
      bucketName: "solar" # 选填 s3下为默认桶名称，nas为默认根路径


## setting for solar monitor
monitor:
  replicaCount: 1
  image:
    repository: registry-dev.uihcloud.cn/com.uih.uplus/solar_monitor
    tag: latest
    pullPolicy: Always

  resources: 
    limits:
        cpu: "1000m"
        memory: "512Mi"
    requests:
        cpu: "1000m"
        memory: "512Mi"
  nodeSelector: {}

  service:
    type: NodePort
    nodePort: 30212

  applicationConf: |-
    server:
      port: 8082

    # Swagger界面内容配置
    swagger:
      title: solar-equipment-monitor API接口文档 #文档title
      description: solar-equipment-monitor Api Documentation #接口描述
      version: 1.0.1 #版本

    # grpc配置
    grpc:
      client:
        solar-equipment-management:
          address: "static://solar-mgr:2429"
          enableKeepAlive: true
          keepAliveWithoutCalls: true
          negotiationType: PLAINTEXT   # 此部分的意义为不进行TSL认证
      server:
        port: 2082

    # 数据源
    spring:
      redis:
        database: 0
        host: 10.6.209.48
        port: 6379
        jedis:
          pool:
            max-active: 8
            max-wait: 1
            max-idle: 8
            min-idle: 0
        timeout: 1000
      datasource:
          username: solar
          password: 1qaz@WSX
          url: jdbc:mysql://10.6.209.48:3306/solar_equipment?useUnicode=true&characterEncoding=utf-8&useSSL=true&serverTimezone=UTC&allowMultiQueries=true
          driver-class-name: com.mysql.cj.jdbc.Driver
          type: com.alibaba.druid.pool.DruidDataSource

    # 集成日志配置
    logging:
      level:
        com:
          uih:
            uplus:
              log:
                svc: info #info、warn、error、off
                dev: info #debug、 info、warn、error、off
      service: solar-equipment-monitor #微服务名称

    #id生成方式，false会调用DefaultIdentifierGenerator来生成id；true会初始化UidGenerator，调用grpc
    uidGenerator:
      open: false

## setting for solar alert
alert:
  replicaCount: 1
  image:
    repository: registry-dev.uihcloud.cn/com.uih.uplus/solar_alert
    tag: latest
    pullPolicy: Always

  resources: 
    limits:
        cpu: "1000m"
        memory: "512Mi"
    requests:
        cpu: "1000m"
        memory: "512Mi"
  nodeSelector: {}

  service:
    type: NodePort
    nodePort: 30217

  applicationConf: |-
    server:
      port: 1428

    # Swagger界面内容配置
    swagger:
      title: solar-equipment-alert API接口文档 #文档title
      description: solar-equipment-alert Api Documentation #接口描述
      version: 1.0.1 #版本

    config:
      alertRetransmission-switch: 1 #设置告警日志重发定时任务开关，1是开，0是关
      scheduled:
        cron: 0 0 */6 * * ? #每6小时执行一次
      alert-log-store-switch: 0 #设置 是否将日志存储到MQ, 1是，0否

      # 数据源
    spring:
      redis:
          database: 0
          host: 10.6.209.48
          port: 6379
          jedis:
            pool:
              max-active: 8
              max-wait: 1
              max-idle: 8
              min-idle: 0
          timeout: 1000
      application:
        name: solar-equipment-alert
      datasource:
        username: solar
        password: 1qaz@WSX
        url: jdbc:mysql://10.6.209.48:3306/solar_equipment?useUnicode=true&characterEncoding=utf-8&useSSL=true&serverTimezone=UTC&allowMultiQueries=true
        driver-class-name: com.mysql.cj.jdbc.Driver
        type: com.alibaba.druid.pool.DruidDataSource
      kafka:
        enabled: true
        producer:
          bootstrap-servers: 10.6.209.48:9092
          acks: 1
          buffer-memory: 67108864
          compression-type: lz4
          retries: 10
          batch-size: 65536
        listener:
          ack-mode: MANUAL
        consumer:
          bootstrap-servers: 10.6.209.48:9092
          enable-auto-commit: false
          auto-offset-reset: earliest
          max-poll-records: 2
          session-timeout: 10000
          max-poll-interval: 1800000
          key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
          value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
          concurrency: 1
          group-id: solar_group_alert

    grpc:
      client:
        solar-equipment-management:
          address: "static://solar-mgr:2429"
          enableKeepAlive: true
          keepAliveWithoutCalls: true
          negotiationType: PLAINTEXT   # 此部分的意义为不进行TSL认证
      server:
        port: 2428

    # 日志配置
    logging:
      level:
        com:
          uih:
            uplus:
              log:
               svc: info #info、warn、error、off
               dev: info #debug、 info、warn、error、off
      service: solar-equipment-alert #微服务名称

    # 多租户配置
    auth:
      anon: /swagger-ui.html,/swagger/**,/webjars/**,/swagger-resources/**,/v2/api-docs,/v1/file/**, /v1/code/**,/health*
      #,/v1/Permission/**    # 可匿名访问路由列表
      oidc:
        provider:
          baseUrl: https://auth-sit-api.uihcloud.cn/v1 # Demo环境统一登录服务地址,URL最后不要加/
    api:
      uapApiUrl: https://portal-sit-api.uihcloud.cn/portal-api/v1 # UAP PORTAL API，包含角色权限,URL最后不要加/
      serviceRoleCode: Service

    #id生成方式，false会调用DefaultIdentifierGenerator来生成id；true会初始化UidGenerator，调用grpc
    uidGenerator:
      open: false

## setting for solar log-inquirer
loginquirer:
  replicaCount: 1
  image:
    repository: registry-dev.uihcloud.cn/com.uih.uplus/solar_loginquirer
    tag: latest
    pullPolicy: Always

  resources: 
    limits:
        cpu: "1000m"
        memory: "512Mi"
    requests:
        cpu: "1000m"
        memory: "512Mi"
  nodeSelector: {}

  service:
    type: NodePort
    nodePort: 30214

  applicationConf: |-
    server:
      port: 8084

    # Swagger界面内容配置
    swagger:
      title: solar-querylog API接口文档 #文档title
      description: solar-querylog Api Documentation #接口描述
      version: 1.0.1 #版本
      termsOfServiceUrl: https://www.united-imaging.com/
      contact:
            name: uih
            url: https://www.united-imaging.com/
            email: uih@united-imaging.com

    grpc:
      client:
        solar-equipment-management:
          address: "static://solar-mgr:2429"
          enableKeepAlive: true
          keepAliveWithoutCalls: true
          negotiationType: PLAINTEXT   # 此部分的意义为不进行TSL认证

    elasticSearch:
      hosts: 10.6.209.48:9200
      backupEnable: true
      clearEnable: true
      obsBackup:
        enable: true
        path: /home/data/elasticsearch/backup
        storageType: s3
        endPoint: http://10.6.5.186:9000
        accessKey: minioadmin
        secretKey: minioadmin
        bucketName: solar
    spring:
      redis:
        database: 0
        host: 10.6.209.48
        port: 6379
        jedis:
          pool:
            max-active: 8
            max-wait: 1
            max-idle: 8
            min-idle: 0
        timeout: 1000

    #健康检查
    management:
      endpoints:
        web:
          base-path: /
      endpoint:
        health:
          show-details: never

    # log配置
    logging:
      level:
        com:
          uih:
            uplus:
              log:
                svc: info #info、warn、error、off
                dev: info #debug、 info、warn、error、off
      service: solar-log-inquirer #微服务名称

    # 多租户配置
    auth:
      anon: /swagger-ui.html,/swagger/**,/webjars/**,/swagger-resources/**,/v2/api-docs,/v1/file/**, /v1/code/**,/health*
      #,/v1/Permission/**    # 可匿名访问路由列表
      oidc:
        provider:
          baseUrl: https://auth-sit-api.uihcloud.cn/v1 # Demo环境统一登录服务地址,URL最后不要加/
    api:
      uapApiUrl: https://portal-sit-api.uihcloud.cn/portal-api/v1 # UAP PORTAL API，包含角色权限,URL最后不要加/

## setting for solar log-parser
logparser:
  replicaCount: 1
  image:
    repository: registry-dev.uihcloud.cn/com.uih.uplus/solar_logparser
    tag: latest
    pullPolicy: Always

  resources: 
    limits:
        cpu: "1000m"
        memory: "512Mi"
    requests:
        cpu: "1000m"
        memory: "512Mi"
  nodeSelector: {}

  service:
    type: NodePort
    nodePort: 30215

  applicationConf: |-
    server:
      port: 8083

    # Swagger界面内容配置
    swagger:
      title: solar-parselog API接口文档 #文档title
      description: solar-parselog Api Documentation #接口描述
      version: 1.0.1 #版本

    # es配置
    elasticSearch:
      hosts: 10.6.209.48:9200

    spring:
      redis:
        database: 0
        host: 10.6.209.48
        port: 6379
        jedis:
          pool:
            max-active: 8
            max-wait: 1
            max-idle: 8
            min-idle: 0
        timeout: 1000
      kafka:
        enabled: false
        producer:
          bootstrap-servers: 10.6.209.48:9092
          acks: 1
          buffer-memory: 67108864
          compression-type: lz4
          retries: 10
          batch-size: 65536
        listener:
           ack-mode: MANUAL
        consumer:
          bootstrap-servers: 10.6.209.48:9092
          enable-auto-commit: false
          auto-offset-reset: earliest
          max-poll-records: 100
          session-timeout: 10000
          max-poll-interval: 300000
          key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
          value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
          concurrency: 1
          group-id: solar_group_parser

    grpc:
      client:
        solar-equipment-management:
          address: "static://solar-mgr:2429"
          enableKeepAlive: true
          keepAliveWithoutCalls: true
          negotiationType: PLAINTEXT   # 此部分的意义为不进行TSL认证
        solar-equipment-alert:
          address: "static://solar-alert:2428"
          enableKeepAlive: true
          keepAliveWithoutCalls: true
          negotiationType: PLAINTEXT   # 此部分的意义为不进行TSL认证

    #更新设备日志上传时间的间隔时间(分钟)
    config:
      log-upload-datetime-threshold: 10
      parse-log-store-switch: 0 #设置 是否将日志存储到MQ, 1是，0否


    #健康检查
    management:
      endpoints:
        web:
          base-path: /
      endpoint:
        health:
          show-details: never

    #solar 向 sc 发送日志的接口
    api:
      scApiUrl: https://10.6.119.21:8080 # solar 向 sc 发送日志的接口地址，URL最后不要加/

    # log配置
    logging:
      level:
        com:
          uih:
            uplus:
              log:
                svc: info #info、warn、error、off
                dev: info #debug、 info、warn、error、off
      service: solar-log-parser #微服务名称

## setting for solar log-receiver
logreceiver:
  replicaCount: 1
  image:
    repository: registry-dev.uihcloud.cn/com.uih.uplus/solar_logreceiver
    tag: latest
    pullPolicy: Always

  resources: 
    limits:
        cpu: "1000m"
        memory: "512Mi"
    requests:
        cpu: "1000m"
        memory: "512Mi"
  nodeSelector: {
    solar-logreceiver: dev
  }

  service:
    type: NodePort
    nodePort: 30216

  applicationConf: |-
    server:
      port: 8088

    # Swagger界面内容配置
    swagger:
      title: Solar-receivelog API接口文档 #文档title
      description: Solar-receivelog Api Documentation #接口描述
      version: 1.0.1 #版本

    spring:
      redis:
        database: 0
        host: 10.6.209.48
        port: 6379
        jedis:
          pool:
            max-active: 8
            max-wait: 1
            max-idle: 8
            min-idle: 0
        timeout: 1000
      kafka:
        bootstrap-servers: 10.6.209.48:9092
        producer:
          acks: 1
          buffer-memory: 67108864
          compression-type: lz4
          retries: 10
          batch-size: 65536

    grpc:
      client:
        solar-equipment-management:
          address: "static://solar-mgr:2429"
          enableKeepAlive: true
          keepAliveWithoutCalls: true
          negotiationType: PLAINTEXT   # 此部分的意义为不进行TSL认证

    #健康检查
    management:
      endpoints:
        web:
          base-path: /
      endpoint:
        health:
          show-details: never

    # log配置
    logging:
      level:
        com:
          uih:
            uplus:
              log:
                svc: info #info、warn、error、off
                dev: info #debug、 info、warn、error、off
      service: solar-log-receiver #微服务名称

    #接收服务IP白名单
    config:
      ip:
        whitelist: 10.6.209.45
      sc-log-switch: 0 #设置 solar 是否向 sc 发送日志的开关，1是发送，0是不发

